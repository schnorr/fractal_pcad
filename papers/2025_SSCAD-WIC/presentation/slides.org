# -*- coding: utf-8 -*-
# -*- mode: org -*-
#+startup: beamer overview indent
#+LANGUAGE: pt-br
#+TAGS: noexport(n)
#+EXPORT_EXCLUDE_TAGS: noexport
#+EXPORT_SELECT_TAGS: export

#+TITLE: Dynamic Load Balancing and Scalability Analysis of the Mandelbrot Set in a Multi-Threaded HPC Application
#+LATEX: \makeatletter \def\beamer@shorttitle{Analysis of the Mandelbrot Set in an HPC Application} \makeatother
#+SUBTITLE: SSCAD-WIC 2025
#+AUTHOR: Francisco Etcheverria, Rayan Raddatz, Kenichi Brumati, Lucas Mello Schnorr
#+DATE: 28/10/2025

#+LATEX_CLASS: beamer
#+LATEX_HEADER: \makeatletter
#+LATEX_HEADER: \def\input@path{{theme/}}
#+LATEX_HEADER: \makeatother
#+BEAMER_THEME:Inf
#+LATEX_CLASS_OPTIONS: [xcolor=dvipsnames,10pt,aspectratio=169]
#+OPTIONS: H:2 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t

#+LATEX_HEADER: \graphicspath{{theme/}{../figures/}{figures/}}

#+LATEX_HEADER: \titlegraphic{%
#+LATEX_HEADER:   \includegraphics[height=0.13\paperheight,keepaspectratio]{figures/capes.jpg}%
#+LATEX_HEADER:   \includegraphics[height=0.13\paperheight,keepaspectratio]{figures/fapergs.png}%
#+LATEX_HEADER:   \includegraphics[height=0.08\paperheight,keepaspectratio]{figures/cnpq.png}%
#+LATEX_HEADER: }

* Introdução

** Roteiro

#+LATEX: \tableofcontents

** Conjunto de Mandelbrot

O conjunto de Mandelbrot \cite{mandelbrot1980} é um conjunto definido pelos pontos complexos \( c \) para os quais a sequência

\[
z_{n+1} = z_n^2 + c, \quad z_0 = 0
\]

permanece limitada, ou seja, não diverge para o infinito após um número finito de iterações.

** Visualização do conjunto

- Cada pixel é associado a um ponto do plano complexo. 
- Cores são atribuídas de acordo com o número de iterações até a sequência divergir.

#+LATEX: \vfill\pause

#+LATEX: \begin{columns}
#+LATEX: \column{0.49\textwidth}
#+LATEX: \includegraphics[width=\linewidth]{figures/frac1.png}
#+LATEX: \column{0.49\textwidth}
#+LATEX: \includegraphics[width=\linewidth]{figures/frac2.png}
#+LATEX: \end{columns}

#+LATEX: \vfill

As imagens resultantes tem uma estrutura fractal, com detalhe infinito sendo encontrado ao ampliar a imagem.

** Aspectos computacionais

- O conjunto de Mandelbrot é *trivialmente paralelizável*: Cada pixel pode ser computado independentemente.
- Diferentes regiões da imagem requerem números de iterações diferentes.
- Logo, o *balanceamento de carga* é importante para se obter performance máxima.

** Trabalhos Relacionados

\cite{gomez2020mpi}:
  - MPI vs OpenMP no cálculo do conjunto
  - Distribuição de trabalho estática vs dinâmica
\cite{mohammed2020two}:
  - Balanceamento dinâmico em dois níveis com MPI e OpenMP
  - Conjunto de Mandelbrot é um dos /benchmarks/

#+LATEX: \pause\vfill

Nosso trabalho: 
  - Arquitetura cliente-servidor
  - Alocação dinâmica da carga de trabalho
  - Investigação da escalabilidade e balanceamento em diferentes cenários

* Materiais e Métodos

** Arquitetura do sistema: Overview

#+BEGIN_CENTER
#+ATTR_LATEX: :width 0.85\textwidth
[[../figures/system_architecture1.pdf]]  
#+END_CENTER

** Arquitetura do sistema: Fluxo (1/4)

#+BEGIN_CENTER
#+ATTR_LATEX: :width 0.85\textwidth
[[../figures/system_architecture2.pdf]]  

#+LATEX:\vfill
*Cliente envia /payload/ ao servidor requisitando uma região do fractal*
#+END_CENTER


** Arquitetura do sistema: Fluxo (2/4)

#+BEGIN_CENTER
#+ATTR_LATEX: :width 0.85\textwidth
[[../figures/system_architecture3.pdf]]  

#+LATEX:\vfill
*Coordenador divide /payload/ em vários menores*
#+END_CENTER

** Arquitetura do sistema: Fluxo (3/4)

#+BEGIN_CENTER
#+ATTR_LATEX: :width 0.85\textwidth
[[../figures/system_architecture4.pdf]]  

#+LATEX:\vfill
*/Workers/ requisitam /payloads/ do coordenador, enviando /responses/ de volta ao calcular*
#+END_CENTER

** Arquitetura do sistema: Fluxo (4/4)

#+BEGIN_CENTER
#+ATTR_LATEX: :width 0.85\textwidth
[[../figures/system_architecture5.pdf]]  

#+LATEX:\vfill
*/Responses/ são redirecionados ao cliente, permitindo visualização progressiva*
#+END_CENTER

** Configuração de hardware

Os experimentos foram executados no Parque Computacional de Alto Desempenho (PCAD) do Instituto de Informática da UFRGS.

#+LATEX: \vfill\pause

O cliente rodou em uma máquina *draco*, com:

- 2x Intel Xeon E5-2640 v2 @ 2.00GHz, 32 cores
- 64GB DDR4

#+LATEX: \pause

O servidor rodou em até seis máquinas *cei*, cada uma com:

- 2x Intel Xeon Silver 4116 @ 2.10GHz, 24 cores por nó
- 96GB DDR4

** Projeto Experimental

- Resolução: 1920\times1080

#+LATEX: \pause

- Granularidade: [5\times5, 10\times10, 20\times20, 40\times40, 60\times60, 120\times120]

#+LATEX: \pause

- Quantidade de nós do servidor: 1 a 6 nós (24 a 144 ranks MPI)

#+LATEX: \pause

- Casos: *easy* estressa o /overhead/ de comunicação, *default* é um caso desbalanceado típico, e *hard* testa a vazão computacional do sistema

#+LATEX: \vfill

#+LATEX: \begin{columns}
#+LATEX: \column{0.33\textwidth}
#+LATEX: \includegraphics[width=\linewidth]{../figures/region_easy.png}
#+LATEX: \centering\footnotesize easy (máx. 1024 it.)
#+LATEX: \column{0.33\textwidth}
#+LATEX: \includegraphics[width=\linewidth]{../figures/region_default.png}
#+LATEX: \centering\footnotesize default (máx. 150000 it.)
#+LATEX: \column{0.33\textwidth}
#+LATEX: \includegraphics[width=\linewidth]{../figures/region_hard.png}
#+LATEX: \centering\footnotesize hard (máx. 300000 it.)
#+LATEX: \end{columns}

#+LATEX: \vfill\pause

- 10 repetições de cada configuração

* Resultados

** Métricas

- *Tempo médio do cliente*: Tempo entre o envio de um /payload/ e chegada do último /response/.

#+LATEX:\pause

- *Speedup*: Razão entre o tempo com um nó e \(n\) nós:
  \[
  S(n) = \frac{T(1)}{T(n)}
  \]

#+LATEX:\pause

- *Eficiência*: Speedup normalizado pelo número de workers.
  \[
  E(n) = \frac{S(n)}{S_{\text{ideal}}(n)}, \quad S_{\text{ideal}}(n) = \frac{24n-1}{23}
  \]

#+LATEX:\pause

- */Imbalance Percentage/* \cite{derose2007detecting}: Mede o desbalanceamento de carga:
  \[
  \text{Imbalance \%} = \frac{L_{max} - L_{avg}}{L_{max}} \times \frac{n}{n-1}
  \]
  onde \(L_{max}\) é o tempo máximo de um worker, \(L_{avg}\) é o médio e \(n\) o número de /workers/.

** Resultados: Tempo médio

#+BEGIN_CENTER
#+ATTR_LATEX: :width 0.8\textwidth :center
[[../figures/client_time.pdf]]  
#+END_CENTER

- Performance no caso /easy/ é melhor com granularidades maiores: a computação é fácil, logo a limitação é o */overhead/ de comunicação*

- Perfomance tende a escalar bem ao adicionar nós nos casos /default/ e /hard/

- Tempo com granularidade 5 piora com mais nós: */overhead/*

- Tempo com granularidade 120 não escala bem no caso /default/: *desbalanceamento*

** Resultados: Speedup e Eficiência

#+LATEX: \begin{columns}
#+LATEX: \column{0.5\textwidth}
#+LATEX: \includegraphics[width=\linewidth]{../figures/client_speedup.pdf}
#+LATEX: \column{0.5\textwidth}
#+LATEX: \includegraphics[width=\linewidth]{../figures/client_efficiency.pdf}
#+LATEX: \end{columns}

#+LATEX:\vfill

- Granularidade 20 apresenta melhor /trade-off/ entre /overhead/ e balanceamento nos casos /default/ e /hard/
- Eficiência de ~0.85 (/default/) e ~0.98 (/hard/) com 6 nós

** Resultados: /Imbalance Percentage/

#+BEGIN_CENTER
#+ATTR_LATEX: :width 0.8\textwidth :center
[[../figures/imbalance_percentage.pdf]]  
#+END_CENTER

- O caso /easy/ apresenta desbalanceamento alto em geral
- O caso /default/ sofre maior desbalaceamento que o caso /hard/
- Desbalanceamento tende a ser menor com granularidades menores
- O desbalanceamento tende a aumentar com o número de nós

* Conclusão

** Considerações finais 

- A *granularidade* é crucial para obter boa performance

#+LATEX: \pause

- Para regiões desbalanceadas ou computacionalmente intensas (/default/ e /hard/), granularidade 20 oferece o melhor /trade-off/

#+LATEX: \pause

- Para regiões simples (/easy/), o /overhead/ de comunicação domina, e adicionar nós pode reduzir performance

#+LATEX: \pause

- A escolha da granularidade deve considerar as características da região do fractal

** Trabalhos futuros

Como trabalho futuro, planejamos investigar a variação da granularidade com base no número de iterações 
da vizinhança, avaliando o impacto no desempenho e no balanceamento de carga.

** Referências

#+LATEX: \bibliographystyle{sbc}
#+LATEX: \bibliography{refs} 

** Agradecimentos

O presente trabalho foi realizado com apoio da Coordenação de Aperfeiçoamento
de Pessoal de Nível Superior – Brasil (CAPES) – Código de Financiamento 001.

#+LATEX: \vfill

Agradecemos também à FAPERGS e ao CNPq pelo suporte financeiro, incluindo
bolsas de iniciação científica da FAPERGS (PROBIC) e do CNPq (PBIC).

#+LATEX: \vfill

Agradecemos ainda à UFRGS pelo suporte institucional e ao Grupo de 
Processamento Paralelo e Distribuído pelo acesso aos recursos do PCAD.

#+LATEX:\vfill

#+LATEX:\begin{center}
#+LATEX:\includegraphics[width=0.33\textwidth,height=0.25\textheight,keepaspectratio]{figures/capes.jpg}
#+LATEX:\includegraphics[width=0.33\textwidth,height=0.25\textheight,keepaspectratio]{figures/fapergs.png}
#+LATEX:\includegraphics[width=0.33\textwidth,height=0.25\textheight,keepaspectratio]{figures/cnpq.png}
#+LATEX:\end{center}

* Bib file                                                         :noexport:
#+begin_src bibtex :tangle refs.bib

@article{gomez2020mpi,
  title={MPI vs OpenMP: A case study on parallel generation of Mandelbrot set},
  author={G{\'o}mez, Ernesto Soto},
  journal={Innovation and Software},
  volume={1},
  number={2},
  pages={12--26},
  year={2020}
}

@inproceedings{mohammed2020two,
  title={Two-level dynamic load balancing for high performance scientific applications},
  author={Mohammed, Ali and Cavelan, Aur{\'e}lien and Ciorba, Florina M and Cabez{\'o}n, Rub{\'e}n M and Banicescu, Ioana},
  booktitle={SIAM Conference on Parallel Processing for Scientific Computing},
  year={2020},
}

@article{mandelbrot1980,
  author = {Mandelbrot, Benoit B.},
  title = { “Fractal Aspects of the Iteration of Z → z $\Lambda$(1-Z) for Complex $\Lambda$ and Z”},
  journal = {Annals of the New York Academy of Sciences},
  volume = {357},
  number = {1},
  pages = {249-259},
  year = {1980}
}

@inproceedings{derose2007detecting,
  title={Detecting application load imbalance on high end massively parallel systems},
  author={DeRose, Luiz and Homer, Bill and Johnson, Dean},
  booktitle={European Conference on Parallel Processing},
  pages={150--159},
  year={2007},
  organization={Springer}
}

#+end_src
